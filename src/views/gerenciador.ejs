<!DOCTYPE html>
<html>
<%- include ('./partials/head') %>

<script>
    $(document).ready(function(){
        $("#selectRodadas").change(function(){
            var idRodada = $(this).children("option:selected").val();
            if(idRodada == 0) {
                $('#listaPartidas').empty();
                return;
            }

            $.ajax({
                type: 'GET',
                url: '/partidas/' + idRodada,
                success: function(response) {
                    $('#listaPartidas').empty();
                    let partidas = response;
                    console.log(partidas)
                    partidas.forEach((partida, index) => {
                        let li = $('<li>').addClass('list-group-item').css("display", "flex");
                        let spanCasa = $('<span>').addClass('placarMandante').css({"width": "45%", "text-align": "right"});
                        let spanCasaTime = $('<div>').text(partida.time_casa).addClass("placarMandante").css({"margin-right": "10%"});
                        let spanCasaInput = $('<div>').css({"float": "right"});
                        let imgIcone = $('<img>').attr({"src": partida.time_casa.normalize('NFD').replace(/[\u0300-\u036f]/g, "") + ".svg"}).addClass("iconeClube").css({"margin-left": "10%"});
                        let inputCasa = $('<input>')
                            .attr({"type": "number", "min": 0, "max": 99, "id": index+1 + "_casa", 
                                "name": partida.time_casa, 
                                "value": partida.gols_time_casa})
                            .addClass('form-control inputPlacar');
                        
                        spanCasaTime.append(imgIcone);
                        spanCasaInput.append(inputCasa);
                        spanCasa.append(spanCasaTime);
                        spanCasa.append(spanCasaInput);
                        li.append(spanCasa);

                        let spanX = $('<span>').addClass('placarX').text("x");
                        li.append(spanX);

                        let spanVisitante = $('<span>').addClass('placarVisitante').css({"width": "45%", "text-align": "left"});
                        let spanVisitanteTime = $('<div>').text(partida.time_visitante).addClass("placarVisitante").css({"margin-left": "10%"});
                        let spanVisitanteInput = $('<div>').css({"float": "left"});

                        let imgIconeVisitante = $('<img>').attr({"src": partida.time_visitante.normalize('NFD').replace(/[\u0300-\u036f]/g, "") + ".svg"}).addClass("iconeClube").css({"margin-left": "10%"});
                        let inputVisitante = $('<input>')
                            .attr({"type": "number", "min": 0, "max": 99, "id": index+1 + "_visitante", 
                                "name": partida.time_visitante, 
                                "value": partida.gols_time_visitante})
                            .addClass('form-control inputPlacar');
                        
                        spanVisitante.append(imgIconeVisitante);
                        spanVisitante.append(inputVisitante);
                        spanVisitante.append(spanVisitanteInput);
                        spanVisitante.append(imgIconeVisitante);
                        spanVisitante.append(spanVisitanteTime);
                        li.append(spanVisitante);
                        $('#listaPartidas').append(li);
                    });
                }
            });
        });
    });
</script>

<body style="min-width: fit-content;">
    <%- include ('./partials/styles') %>
    <%- include ('./partials/messages') %>
    <form action="/gerenciar/<%= campeonato._id %>" method="POST">
    <div class="container-fluid" style="margin-top: 1rem;">
        <div class="row">
            <div class="col-sm-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Nome</h5>
                    <input type="text" class="form-control" id="nome" name="nome"  placeholder="username" value="<%= campeonato.nome %>"/>
                </div>
            </div>
            </div>

            <div class="col-sm-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Ano</h5>
                        <input type="number" class="form-control" id="ano" name="ano"  placeholder="ano" min="1950" value="<%= campeonato.ano %>"/>
                    </div>
                </div>
            </div>

            <div class="col-sm-2">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Rodada Atual</h5>
                        <input type="number" min="1" max="38" class="form-control" id="rodadaAtual" name="rodada_atual"  placeholder="rodada atual"  
                            value="<%= campeonato.rodada_atual %>"/>
                    </div>
                </div>
            </div>
        </div>
        
        <br/>

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <select  class="form-control"  id="selectRodadas" data-placeholder="Selecione a rodada" name="rodada">
                            <option value="0">-- Selecione uma Rodada --</option>
                            <%    rodadas.forEach(function(rodada){ %>
                                <option value="<%= rodada._id %>">Rodada <%= rodada.numero %></option>
                            <%    })        %>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body" id="cardPartidas">
                        <ul class="list-group list-group-flush" id="listaPartidas">
                            <!-- lista de partidas geradas dinamicamente -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <br/>

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <button type="submit" class="btn btn-primary btn-block">Salvar</button>
                    </div>
                </div>
            </div>
        </div>

      </div>
    </form>
</body>
</html>